@using EduPlanApp.Models
@model TaskSearchModel

@{
    ViewData["Title"] = "Пошук Завдань";
    Layout = "_Layout";
}

<h1 class="text-3xl font-bold mb-6">@ViewData["Title"]</h1>
<p class="mb-6 text-gray-600">Використовуйте різні критерії для пошуку завдань, включаючи дати, частини назви та фільтрацію за категоріями.</p>

<div class="bg-white shadow-xl rounded-lg p-8 mb-8">
    <form asp-action="DeadlineManager" method="post" class="space-y-6">
        <h2 class="text-xl font-semibold text-gray-900 border-b pb-2 mb-4">Критерії Пошуку</h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Пошук за датою -->
            <div>
                <label asp-for="DateFrom" class="block text-sm font-medium text-gray-700"></label>
                <input asp-for="DateFrom" type="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" />
            </div>
            <div>
                <label asp-for="DateTo" class="block text-sm font-medium text-gray-700"></label>
                <input asp-for="DateTo" type="date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" />
            </div>

            <!-- Пошук за початком та кінцем -->
            <div>
                <label asp-for="TitleStartsWith" class="block text-sm font-medium text-gray-700"></label>
                <input asp-for="TitleStartsWith" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="Наприклад, Лабораторна" />
            </div>
            <div>
                <label asp-for="TitleEndsWith" class="block text-sm font-medium text-gray-700"></label>
                <input asp-for="TitleEndsWith" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="Наприклад, 3" />
            </div>
        </div>

        <!-- Фільтрація за списком елементів -->
        <div>
            <label asp-for="CategoryNamesCsv" class="block text-sm font-medium text-gray-700"></label>
            <input asp-for="CategoryNamesCsv" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 p-2 border" placeholder="Введіть назви категорій через кому (наприклад, Проект, Іспит)" />
            <p class="mt-2 text-xs text-gray-500">Пошук виконується за точним збігом назв категорій (регістр важливий).</p>
        </div>

        <div class="pt-4">
            <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150">
                Знайти Завдання
            </button>
        </div>
    </form>
</div>

<!-- Блок Результатів Пошуку -->
<h2 class="text-2xl font-bold mb-4">@Model.SearchMessage</h2>

@if (Model.SearchResults.Any())
{
    <div class="shadow-lg rounded-lg overflow-hidden">
        <table class="min-w-full divide-y divide-gray-200">
            <thead class="bg-gray-100">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Завдання</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Категорія</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Пріоритет</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Термін</th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Статус</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                @foreach (var task in Model.SearchResults)
                {
                    <tr class="@(task.IsCompleted ? "bg-green-50" : (task.DueDate < DateTimeOffset.Now ? "bg-red-50" : ""))">
                        <td class="px-6 py-4 whitespace-nowrap font-medium text-gray-900">
                            <a asp-action="TaskDetails" asp-route-id="@task.Id" class="text-indigo-600 hover:text-indigo-900">@task.Title</a>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@task.CategoryName</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full
                                        @(task.PriorityName == "Високий" ? "bg-red-100 text-red-800" : task.PriorityName == "Середній" ? "bg-yellow-100 text-yellow-800" : "bg-blue-100 text-blue-800")">
                                @task.PriorityName
                            </span>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">@task.DueDate.ToLocalTime().ToString("dd.MM.yyyy HH:mm")</td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full @(task.IsCompleted ? "bg-green-100 text-green-800" : "bg-yellow-100 text-yellow-800")">
                                @(task.IsCompleted ? "Виконано" : "В роботі")
                            </span>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}